 - name: Install db2Dev
   hosts: db2dev.ifmssystem.com
   tasks: 

    # - name: Confirm that the group DB2ADMNS exists
      # win_group:
        # name: DB2ADMNS
        # state: present 

    # - name: Add db2admin and DBAs to the group DB2ADMNS
      # win_group_membership:
        # name: DB2ADMNS
        # members:
        # - .\db2admin
        # - ifms\zzflatlly
        # - ifms\zzcoreydi
        # - ifms\zzkingba
        
    # - name: Confirm that db2admin is in the group DB2ADMNS
      # win_user:
        # name: db2admin
        # groups_action: add
        # state: query
        # groups:
        # - DB2ADMNS
        # - Remote Desktop Users
        # - Administrators
   
    # - name: invoke pre-install-steps.ps1
      # script: pre-install-steps.ps1
      # register: rc
    
    # - name: Print the output
      # debug: var=rc.stdout

    # - name: pause the install
      # pause:
        # prompt: "Review output"
      
    - name: Install DB2
      raw: D:\DB2_ADMIN\DB2_INSTALL\db2install.bat
 
    - name: wait for 5 minutes
      win_wait_for:
        timeout: 300

# if file  exists, this means the install is done 
    - name: test to see if file  exists 
      script: TestPath.ps1
      register: path_result
      failed_when: path_result.stdout != "The file exists\r\n"
      
    - debug: 
        var: path_result.stdout      
 
    - name: Reboot the server
      win_reboot: 
       #pre_reboot_delay: 120     

    # - name: Ensure that the IBM SSH Service is stopped and disabled
      # win_service:
        # name: ibmsshd
        # start_mode: disabled
        # state: stopped       

    # - name: Ensure that the DB2 Management Service logs on as db2admin
      # win_service:
        # name: db2mgmtsvc_c1
        # username: .\db2admin
        # password: "{{ pword }}"       
            
    - name: Run the DB2 validations
      script: RunDB2Validations.ps1
      register: rc
    
    # - name: Print the output
      # debug: var=rc.stdout
      
    # - name: pause after the validations
      # pause:
        # prompt: "Review validation output"
      
      
    - name: Run the DB2 sample db script
      script: RunDB2Sample.ps1
      register: rc

### -- create the database directory structure ---      
      
    - name: Create directories for the databases being restored
      win_file: 
        path: D:\DB2_DATABASE
        state: directory        
        
    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV
        state: directory       
        
    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\CONSOL
        state: directory 

    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\CONSOL\autodata
        state: directory                

    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\CONSOL\db2_logs
        state: directory        
        
    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\CONSOL\db2_logs\archived_logs
        state: directory   
        
    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\CONSOL\db2_logs\fail_archived_logs
        state: directory        
        
    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\STAGING
        state: directory        
        
    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\STAGING\autodata
        state: directory        
        
    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\STAGING\db2_logs
        state: directory        
        
    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\STAGING\db2_logs\archived_logs
        state: directory   
        
    - name: Create directories for the databases
      win_file: 
        path: D:\DB2_DATABASE\IFMSDV\STAGING\db2_logs\fail_archived_logs
        state: directory        
        